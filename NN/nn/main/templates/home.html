<!DOCTYPE html>
<html>
    <head>
        <title>MNIST</title>
        <meta charset="utf-8">
    </head>
    <body>
      <H1> MNIST Check </H1>
      <div>
      <input type="file" id="file" accept=".dat">
      </div>
        {% load static %}
        {% load staticfiles %}
        <script src="{% static 'js/draw.js' %}"></script>
        <script src="{% static 'js/judge.js' %}"></script>
        <script src="{% static 'js/model.js' %}"></script>
        <canvas id='canvas' width=448 height=448  style="background-color:black;"></canvas>
        <canvas id='canvas2' width=448 height=448  style="background-color:black;"></canvas>
        <div>
          <button type="button" onclick="check()" id ="checkButton" class="button" disabled>Check</button>
          <button type="button" onclick="allClear()" class="button">Clear</button>
        </div>
        <div id="result" class="result">
        </div>
<script>
  window.onload = function(){
    drawSetup($('canvas'),$('canvas2'));
    loadData();
  }
  var model;
  function onFileSelect(e) { var f = e.target.files;
    var reader = new FileReader();
    reader.onload = function(filename){
      var fs = new Float32Stream(reader.result);
      model = new Model(fs);
      $('checkButton').disabled = "";
    }
    reader.readAsArrayBuffer(f[0]);
  }
  $('file').addEventListener('change', onFileSelect, false);

  function check(){
    var x = getX($('canvas'));
    var i = model.recognize(x);
    $('result').innerHTML = "Your figure is " + i + "!";
  }

  function allClear(){
    $('result').innerHTML = "";
    canvasClear($('canvas'));
    canvasClear($('canvas2'));
  }
  function loadData(){
    var xhr = new XMLHttpRequest();
    xhr.open('GET', 'test.dat', true);
    xhr.responseType = 'arraybuffer';
    xhr.onload = function (e){
      var arrayBuffer = xhr.response;
      if(arrayBuffer){
      var fs = new Float32Stream(arrayBuffer);
      model = new Model(fs);
      $('checkButton').disabled = "";
      }
    }
    xhr.send(null);
  }

  function $(id){
    return document.getElementById(id);
  }
</script>

</body>
</html>
